---
date: '2021-07-30 22:12:12'
layout: 'post'
meta:
- charset: 'utf-8'
- content: 'TeX4ht (https://tug.org/tex4ht/)'
  name: 'generator'
- content: 'width=device-width,initial-scale=1'
  name: 'viewport'
- content: '2021-07-30-how-to-blog-with-tex4ht.tex'
  name: 'src'
styles:
- '2021-07-30-how-to-blog-with-tex4ht.css'
time: 1627683132
title: 'How to Blog With TeX4ht'
updated: 1755865434
---


<!--   l. 9   --><p class='indent'>   This post is part of a series on how to set up <a href='https://tug.org/tex4ht/'>TeX4ht</a>, the LaTeX to XML
converter, for use with Static Site Generators. In this article, we’ll discuss how to
configure it to produce suitable HTML.

</p>   
<h3 class='likesectionHead' id='contents'><a id='x1-1000'></a>Contents</h3>
<div class='tableofcontents'>   
<span class='sectionToc'>1 <a href='#static-site-extension-for-makeht' id='QQ2-1-2'>Static site extension for make4ht</a></span>
<br />   <span class='sectionToc'>2 <a href='#copy-the-generated-files-to-the-static-site' id='QQ2-1-3'>Copy the generated files to the static site</a></span>
<br />   <span class='sectionToc'>3 <a href='#automatic-compilation-of-changed-latex-files' id='QQ2-1-4'>Automatic compilation of changed LaTeX files</a></span>
<br />   <span class='subsectionToc'>3.1 <a href='#rebuildsh-script-functionality' id='QQ2-1-5'><span class='ec-lmtt-10'>rebuild.sh </span>Script Functionality</a></span>
</div>   

<h3 class='sectionHead' id='static-site-extension-for-makeht'><span class='titlemark'>1   </span> <a id='x1-20001'></a>Static site extension for make4ht</h3>
<!--   l. 15   --><p class='noindent'>The conversion process used by TeX4ht is quite complex. It requires compiling a
LaTeX file to a DVI file with special instructions inserted by the <span class='ec-lmtt-10'>tex4ht.sty</span>
package. This DVI file is then processed by the <span class='ec-lmtt-10'>tex4ht </span>command, which produces
HTML or XML files, along with instructions for the final command, <span class='ec-lmtt-10'>t4ht</span>, which
generates CSS files and images.
</p><!--   l. 17   --><p class='indent'>   Traditionally, this process was handled by the <span class='ec-lmtt-10'>htlatex </span>script, but it had many
weaknesses. The currently recommended build tool is <span class='ec-lmtt-10'>make4ht</span>. You can find
some details about the differences between <span class='ec-lmtt-10'>htlatex </span>and <span class='ec-lmtt-10'>make4ht</span> in the
<a href='https://www.kodymirus.cz/make4ht/make4ht-doc.html#difference-of-texttt-makeht'><span class='ec-lmtt-10'>make4ht</span> documentation</a>.
</p><!--   l. 19   --><p class='indent'>   Among the features provided by <span class='ec-lmtt-10'>make4ht</span> are Lua build files, post-processing
filters, and extensions. We can use these features to transform HTML files produced
by TeX4ht into the format required by static site generators.
                                                                  

                                                                  
</p><!--   l. 21   --><p class='indent'>   Filters can clean up the generated files and fix common issues that are difficult to
address at the TeX level. They can be applied either from Lua build files or using
<span class='ec-lmtt-10'>make4ht</span> extensions.
</p><!--   l. 23   --><p class='indent'>   <span class='ec-lmtt-10'>make4ht</span> provides an extension that specifically supports static site generators.
Let’s demonstrate its usage with a simple example:
                                                                  

                                                                  
</p>   
<pre class='verbatim' id='verbatim-1'>
\documentclass{article}
\begin{document}
\title{Hello world test}
\author{Michal}
\maketitle

This is my test post.
\end{document}
</pre>
<!--   l. 34   --><p class='nopar'>
</p><!--   l. 36   --><p class='indent'>   You can use the following command to generate a file suitable for static site
generators:
                                                                  

                                                                  
</p>   
<pre class='verbatim' id='verbatim-2'>
make4ht -f html5+staticsite filename.tex
</pre>
<!--   l. 40   --><p class='nopar'>
</p><!--   l. 42   --><p class='indent'>   By default, the <span class='ec-lmtt-10'>staticsite </span>extension produces a file named as
<span class='obeylines-h'><code class='verb'>YYYY-MM-DD-&lt;filename&gt;</code></span>, so this example might be named <span class='ec-lmtt-10'>2021-07-25-filename.html</span>.
It’s not an ordinary HTML file, but it contains a YAML header with document
metadata:
                                                                  

                                                                  
</p>   
<pre class='verbatim' id='verbatim-3'>
---
meta:
- charset: ’utf-8’
- name: ’generator’
  content: ’TeX4ht (https://tug.org/tex4ht/)’
- name: ’viewport’
  content: ’width=device-width,initial-scale=1’
- name: ’src’
  content: ’2021-07-18-hello-world.tex’
time: 1626619562
updated: 1627244699
styles:
- ’2021-07-18-hello-world.css’
title: ’Hello world test’
---
   
&lt;p class=’indent’&gt;   This is my test post.
&lt;/p&gt;
    
</pre>
<!--   l. 64   --><p class='nopar'>
</p><!--   l. 66   --><p class='indent'>   Although most static site generators expect Markdown, they also accept HTML
files in this format. When <span class='ec-lmtt-10'>staticsite </span>is used for the first time, it creates a file with
a <span class='ec-lmtt-10'>.published </span>extension. This file contains a timestamp of the moment it was
first used. This timestamp is then used for the date part of the generated
filename.

</p>   
<h3 class='sectionHead' id='copy-the-generated-files-to-the-static-site'><span class='titlemark'>2   </span> <a id='x1-30002'></a>Copy the generated files to the static site</h3>
<!--   l. 70   --><p class='noindent'>The <span class='ec-lmtt-10'>staticsite </span>extension can copy the generated files to the locations where the
static site generator expects to find files to process.
</p><!--   l. 72   --><p class='indent'>   Let’s say we have the following directory structure, suitable for the <a href='https://jekyllrb.com/'>Jekyll</a> static
site generator:
                                                                  

                                                                  
</p>   
<pre class='verbatim' id='verbatim-4'>
blog/
.. texposts_root/
.... first_post/
...... first_post.tex
.... second_post/
...... second_post.tex
.. docs/_posts/
.. .make4ht
</pre>
<!--   l. 83   --><p class='nopar'>
</p><!--   l. 85   --><p class='indent'>   The blog’s main directory contains the file <span class='ec-lmtt-10'>.make4ht</span>, and two directories:
<span class='obeylines-h'><code class='verb'>texposts_root</code></span> and <span class='obeylines-h'><code class='verb'>docs/_posts</code></span>. Jekyll has built-in support for blogs. It uses all
HTML documents contained within the <span class='obeylines-h'><code class='verb'>_posts</code></span> subdirectory. We’ll then use the <span class='ec-lmtt-10'>docs</span>
directory as the source directory for GitHub Pages.
</p><!--   l. 91   --><p class='indent'>   The source LaTeX files are stored in subdirectories of <span class='obeylines-h'><code class='verb'>texposts_root</code></span>. We
want to automatically copy the generated HTML files to <span class='obeylines-h'><code class='verb'>docs/_posts/</code></span>.
The <span class='ec-lmtt-10'>staticsite </span>extension can be configured to do this using the <span class='ec-lmtt-10'>.make4ht</span>
configuration file. This file is used to pass shared configuration to <span class='ec-lmtt-10'>make4ht</span>, such as
specifying that all generated files should be copied to the <span class='obeylines-h'><code class='verb'>docs/_posts/</code></span>
directory.
</p><!--   l. 98   --><p class='indent'>   The basic format of the <span class='ec-lmtt-10'>.make4ht </span>file necessary for the <span class='ec-lmtt-10'>staticsite </span>extension can
look like this:
                                                                  

                                                                  
</p>   
<pre class='verbatim' id='verbatim-5'>
filter_settings "staticsite" {
  site_root = "../../docs/_posts/"
  header = {
    layout="post",
  },
}

if mode=="publish" then
  Make:enable_extension "staticsite"
  Make:htlatex {}
  Make:htlatex {}
end
</pre>
<!--   l. 113   --><p class='nopar'>
</p><!--   l. 115   --><p class='indent'>   The <span class='obeylines-h'><code class='verb'>filter_settings</code></span> function passes a table with settings for the extension. The
<span class='obeylines-h'><code class='verb'>site_root</code></span> field specifies the path to the directory for the generated files. It can be
specified in a relative form, as in this example. Two <span class='obeylines-h'><code class='verb'>..</code></span> are necessary because the
output directory is located two levels up in the directory hierarchy from the directory
of the compiled TeX file.
</p><!--   l. 121   --><p class='indent'>   We also specify the build sequence for site generation. If we pass the
<span class='obeylines-h'><code class='verb'>--mode publish</code></span> option to <span class='ec-lmtt-10'>make4ht</span>, the <span class='ec-lmtt-10'>staticsite </span>extension will be enabled, and
LaTeX will be executed twice. This is important because the contents of the <span class='obeylines-h'><code class='verb'>\title</code></span>
and <span class='obeylines-h'><code class='verb'>\author</code></span> commands are only available in the second LaTeX run. They are then
included in the YAML header.
</p><!--   l. 127   --><p class='indent'>   You can now execute the following command in the <span class='obeylines-h'><code class='verb'>texposts_root/first_post</code></span>
directory:
                                                                  

                                                                  
</p>   
<pre class='verbatim' id='verbatim-6'>
make4ht -m publish first_post.tex
</pre>
<!--   l. 131   --><p class='nopar'>
</p><!--   l. 133   --><p class='indent'>   This will automatically load the <span class='ec-lmtt-10'>staticsite </span>extension, thanks to our <span class='ec-lmtt-10'>.make4ht</span>
file, so it’s not necessary to enable it on the command line. The generated HTML and
CSS files will be placed in the <span class='obeylines-h'><code class='verb'>docs/_posts/</code></span> directory.
</p><!--   l. 135   --><p class='indent'>   In the next post, we will look at how to use this setup with Jekyll to create a
simple blog.
</p><!--   l. 137   --><p class='indent'>   The <a href='https://github.com/michal-h21/testblog/blob/main/.make4ht'>.make4ht</a> file provided in this blog repository also adds a new function that
writes a <span class='obeylines-h'><code class='verb'>&lt;input&gt;.published</code></span> file. This file is used by the <span class='ec-lmtt-10'>staticsite </span>extension to
find the original publication date of a post. You should add the <span class='ec-lmtt-10'>published </span>file to
your source repository so the correct date is used in future updates of the
site.

</p>   
<h3 class='sectionHead' id='automatic-compilation-of-changed-latex-files'><span class='titlemark'>3   </span> <a id='x1-40003'></a>Automatic compilation of changed LaTeX files</h3>
<!--   l. 141   --><p class='noindent'>Instead of compiling documents manually after each change, you can automate the
build process using the <a href='https://github.com/michal-h21/siterebuild'>siterebuild</a> script.
</p><!--   l. 143   --><p class='indent'>   This tool checks all TeX files in your document directory tree for changes and
lists only the modified files. This is especially important as your blog grows, as it
would be wasteful to compile all source files on every update.

</p>   
<h4 class='subsectionHead' id='rebuildsh-script-functionality'><span class='titlemark'>3.1   </span> <a id='x1-50003.1'></a><span class='ec-lmtt-10'>rebuild.sh </span>Script Functionality</h4>
<!--   l. 147   --><p class='noindent'>I’ve provided a shell script named <a href='https://github.com/michal-h21/testblog/blob/main/texposts/rebuild.sh'>rebuild.sh</a>, which is included in the TeX files
root directory. It uses <span class='ec-lmtt-10'>siterebuild </span>to automatically compile the changed
TeX files:
                                                                  

                                                                  
</p>   
<pre class='verbatim' id='verbatim-7'>
#!/bin/sh
if ! command -v siterebuild &amp;&gt; /dev/null
then
SITEREBUILD=../siterebuild/siterebuild
else
SITEREBUILD=siterebuild
fi

export TEXINPUTS=.:/root/texmf//:

$SITEREBUILD -l debug
# we use the custom output format for siterebuild, to be able to easily extract directory and filename in the later steps
for i in ‘$SITEREBUILD -o %dir@%file‘
do
  texdir=‘echo $i | cut -d@ -f1 -‘
  texfile=‘echo $i | cut -d@ -f2 -‘
  # either execute Makefile, or run make4ht directly
  cd "$texdir"
  if test -f Makefile; then
    make
  else
    TEXINPUTS=.:/root/texmf//: make4ht -a debug -m publish -l "$texfile"
  fi
  cd ..
done
</pre>
<!--   l. 175   --><p class='nopar'>
</p><!--   l. 177   --><p class='indent'>   It first checks for the availability of the <span class='ec-lmtt-10'>siterebuild </span>command, using either a
system-wide installation or a local version from the repository. The script then
executes <span class='ec-lmtt-10'>siterebuild </span>with debug logging to identify modified LaTeX files that
require recompilation.
</p><!--   l. 182   --><p class='indent'>   Using a custom output format (<span class='obeylines-h'><code class='verb'>%dir@%file</code></span>), it extracts both the directory path
and filename for each changed document. For each detected file, the script navigates
to the corresponding directory and checks for a <span class='ec-lmtt-10'>Makefile</span>. If one is present, it uses
the existing build system; otherwise, it directly invokes <span class='ec-lmtt-10'>make4ht </span>with publishing
options to generate the HTML output.
</p><!--   l. 189   --><p class='indent'>   If you want to change the options for <span class='ec-lmtt-10'>make4ht </span>used for the compilation, you can
edit the <span class='ec-lmtt-10'>rebuild.sh </span>file. If you want to change options for only one file, you can
create a <span class='ec-lmtt-10'>Makefile </span>in that file’s directory and put the necessary compilation
commands in that <span class='ec-lmtt-10'>Makefile</span>.
</p>   
 
